/*
 * This file was generated by the Gradle 'init' task.
 *
 * This project uses @Incubating APIs which are subject to change.
 */
plugins {
    id "java"
    id "monticore" // version "$mc_version"
    id "maven-publish"
}

def junit_version = '4.13.1'
def grammarDir = 'src/main/grammars'

group = "scolar"
version = '1.0.4-SNAPSHOT'
description = 'xtext-language-component-tool'
sourceCompatibility = "11"
def fd_version = "7.5.0"
def grammar_classifier = "grammars"
def xtextVersion = '2.34.0'

buildDir = file("$projectDir/target")

// configure non-standard source sets
sourceSets {
    main.java.srcDirs += ['$projectDir/target/generated-sources/monticore/sourcecode','$projectDir/src/main/resources']
    grammars {
        resources {
            srcDirs([grammarDir])
            include "**/*.mc4"
        }
    }
}

dependencies {


    implementation("scolar:language-family-tool:$scolar_core_version") {
        exclude group: 'org.antlr', module: 'antlr-runtime'

    }
    implementation("scolar:language-component-tool:$scolar_core_version") {
        exclude group: 'org.antlr', module: 'antlr-runtime'

    }
    implementation("scolar:customization-interface-tool:$scolar_core_version") {
        exclude group: 'org.antlr', module: 'antlr-runtime'
    }

    implementation group: 'org.apache.commons', name: 'commons-lang3', version: '3.14.0'
    implementation "de.se_rwth.commons:se-commons-logging:$se_commons_version"
    implementation "de.se_rwth.commons:se-commons-utilities:$se_commons_version"
    implementation group: 'org.freemarker', name: 'freemarker', version: '2.3.32'
    testImplementation group: 'junit', name: 'junit', version: junit_version

    implementation ("org.eclipse.xtext:org.eclipse.xtext:${xtextVersion}") {
        exclude group: 'org.antlr', module: 'antlr4'
        exclude group: 'org.antlr', module: 'antlr4-runtime'
        exclude group: 'org.antlr', module: 'ST4'
    }
    implementation ("org.eclipse.xtext:org.eclipse.xtext.common.types:${xtextVersion}") {
        exclude group: 'org.antlr', module: 'antlr4'
        exclude group: 'org.antlr', module: 'antlr4-runtime'
        exclude group: 'org.antlr', module: 'ST4'

    }
    implementation ("org.eclipse.emf:org.eclipse.emf.ecore:${xtextVersion}") {
        exclude group: 'org.antlr', module: 'antlr4'
        exclude group: 'org.antlr', module: 'antlr4-runtime'
        exclude group: 'org.antlr', module: 'ST4'
    }
    implementation ("org.eclipse.xtext:org.eclipse.xtext.util:${xtextVersion}") {
        exclude group: 'org.antlr', module: 'antlr4'
        exclude group: 'org.antlr', module: 'antlr4-runtime'
        exclude group: 'org.antlr', module: 'ST4'
    }

    grammar "de.monticore.lang:fd-lang:$fd_version:$grammar_classifier"
    implementation ("de.monticore.lang:fd-lang:$fd_version") {
        exclude group: 'org.antlr', module: 'antlr-runtime'
    }
    implementation ("de.monticore.lang:cd4analysis:$mc_version") {
        exclude group: 'org.antlr', module: 'antlr-runtime'
    }
    implementation ("de.monticore:javaDSL:$mc_version") {
        exclude group: 'org.antlr', module: 'antlr-runtime'
    }


//    implementation 'org.antlr:antlr4:4.12.0'
//    implementation 'org.antlr:antlr4-runtime:4.12.0'
//    implementation 'org.antlr:ST4:4.3.4'
    implementation 'org.antlr:antlr-runtime:3.2'


    // Guice (used by Xtext)
    implementation 'com.google.inject:guice:5.1.0'

    // For Xtext parsing support (IParser, ParseResult)
    //implementation "org.eclipse.xtext:org.eclipse.xtext.xtext:${xtextVersion}"

    // EMF core (optional if you do resource loading or AST traversal)

}

//configurations.all {
//    resolutionStrategy {
//        // Force Xtext versions only
//        force "org.eclipse.xtext:org.eclipse.xtext:${xtextVersion}"
//    }

//    // Strip out any old or duplicate antlr versions
//    exclude group: 'org.antlr', module: 'antlr4'
//    exclude group: 'org.antlr', module: 'antlr4-runtime'
//    exclude group: 'org.antlr', module: 'ST4'

//}

compileJava {
    dependsOn project.collect { it.tasks.withType(MCTask) }
}

java {
    withSourcesJar()
    registerFeature('grammars') {
        usingSourceSet(sourceSets.grammars)
    }
}

sourcesJar.dependsOn project.collect { it.tasks.withType(MCTask) }

// configure deployment
publishing {
    // configure what artifacts to publish
    publications {
        scolar(MavenPublication) {
            artifactId = "$project.name"
            from components.java
        }
    }
    repositories.maven {
        credentials.username mavenUser
        credentials.password mavenPassword
        def releasesRepoUrl = "https://nexus.se.rwth-aachen.de/content/repositories/scolar-releases/"
        def snapshotsRepoUrl = "https://nexus.se.rwth-aachen.de/content/repositories/scolar-snapshots/"
        url = version.endsWith("SNAPSHOT") ? snapshotsRepoUrl : releasesRepoUrl
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

task buildAll(type: GradleBuild) {
    ext.message = 'buildAll'
    tasks = ['build']
}

defaultTasks 'build'

// configure deployment
publishing {
    // configure what artifacts to publish
    publications {
        languageFamily(MavenPublication) {
            artifactId = "$project.name"
            from components.java
        }
    }
    repositories.maven {
        credentials.username mavenUser
        credentials.password mavenPassword
        def releasesRepoUrl = "https://nexus.se.rwth-aachen.de/content/repositories/scolar-releases/"
        def snapshotsRepoUrl = "https://nexus.se.rwth-aachen.de/content/repositories/scolar-snapshots/"
        url = version.endsWith("SNAPSHOT") ? snapshotsRepoUrl : releasesRepoUrl
    }
}