/*
 * This file was generated by the Gradle 'init' task.
 *
 * This project uses @Incubating APIs which are subject to change.
 */
plugins {
    id "java"
    id "monticore" //version "$mc_version"
}

def junit_version = '4.13.1'
def grammarDir = 'src/main/grammars'

group = "scolar"
version = '1.0.4-SNAPSHOT'
description = 'mc-implication-calculator'
sourceCompatibility = "11"

buildDir = file("$projectDir/target")

// configure non-standard source sets
sourceSets {
    main.java.srcDirs += ["$projectDir/target/generated-sources/monticore/sourcecode"]
    grammars {
        resources {
            srcDirs([grammarDir])
            include "**/*.mc4"
        }
    }
}

dependencies {
    implementation "scolar:language-family-tool:$scolar_core_version"
    implementation "scolar:language-component-tool:$scolar_core_version"
    implementation "scolar:customization-interface-tool:$scolar_core_version"

    implementation project(':mc-language-component-tool')
    implementation "de.se_rwth.commons:se-commons-logging:$se_commons_version"
    implementation "de.se_rwth.commons:se-commons-utilities:$se_commons_version"
    implementation "de.monticore:monticore-runtime:$mc_version"

}


java {
    withSourcesJar()
    registerFeature('grammars') {
        usingSourceSet(sourceSets.grammars)
    }
}

jar.dependsOn grammarsJar

compileJava {
    dependsOn project.collect { it.tasks.withType(MCTask) }
}


sourcesJar.dependsOn project.collect { it.tasks.withType(MCTask) }

// generated java doc contains errors, disable for now
javadoc.failOnError(false)


//jar.dependsOn(shadowJar)


tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

task testReport(type: TestReport) {
    ext.message = 'testReport'
    destinationDir = file("$buildDir/reports/allTests")
    // Include the results from the 'test' task
    reportOn tasks.withType(Test)
}


task buildAll(type: GradleBuild) {
    ext.message = 'buildAll'
    tasks = ['build']
}

defaultTasks 'build'
